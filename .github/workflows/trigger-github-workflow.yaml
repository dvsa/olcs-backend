name: Trigger GH Actions Workflow

on:
  workflow_call:
    secrets:
      gh_token:
        required: true

jobs:

  trigger-gh-workflow:

    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:

    - name: Checkout the repository to the runner
      uses: actions/checkout@v3

    - name: Trigger Workflow
      run: |
        gh workflow run 'CD NON-PROD VOL API' \
          -R dvsa/dvsa-container-registry \
          --ref feature/AWSRESET1-514 \
          -f vol_api_image_tag=vol-api-7.4.33-alpine-fpm-ddea10a
      env:
        GITHUB_TOKEN: ${{ secrets.gh_token }}
    
    - name: Monitor Workflow Execution Progress
      run: |
        runID=`gh run list -w 'CD NON-PROD VOL API' --repo dvsa/dvsa-container-registry -L 1 --json databaseId | jq '.[]| .databaseId'`
        gh run watch $runID -i1
      env:
        GITHUB_TOKEN: ${{ secrets.gh_token }}
